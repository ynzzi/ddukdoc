<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>문의 내역</title>
    <link rel="stylesheet" href="/css/qnaList.css">
    <style>
        /* 모달창 배경 */
        .modal {
            display: none;
            position: fixed;
            z-index: 999;
            left: 0; top: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.5);
        }
        /* 모달 안쪽 박스 */
        .modal-content {
            background: #fff;
            width: 500px;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            position: relative;
            margin: 10% auto;
            font-family: Arial, sans-serif;
        }
        /* 닫기 버튼 */
        .close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            cursor: pointer;
        }
        h1 {
            text-align: center;
        }
        .modal-section-title {
            font-size: 1.1rem;
            font-weight: bold;
            border-bottom: 2px solid #1e60c8;
            padding-bottom: 0.25rem;
            margin: 1rem 0 0.5rem;
            color: #1e60c8;
        }
        .info-row {
            display: flex;
            padding: 0.4rem 0;
            border-bottom: 1px solid #eee;
        }
        .info-label {
            flex: 0 0 140px;
            font-weight: bold;
            color: #555;
        }
        .info-value {
            flex: 1;
            color: #222;
            word-break: break-word;
        }
    </style>
</head>
<body>

<h1>문의 내역</h1>

<!-- 메인 버튼 -->
<div class="top-bar">
    <button class="home-button" th:onclick="|location.href='/doc/main'|">메인으로</button>
</div>

<!-- 미답변 목록 -->
<h2>미답변 문의</h2>
<table>
    <thead>
    <tr>
        <th>NO</th><th>제목</th><th>작성자</th><th>작성일</th><th>답변</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="list, iterStat : ${isPending}">
        <td th:text="${iterStat.index + 1}"></td>
        <td th:text="${list.title}"></td>
        <td th:text="${list.writer.username}"></td>
        <td th:text="${#temporals.format(list.createdAt, 'yyyy-MM-dd HH:mm:ss')}"></td>
        <td><button th:onclick="|location.href='/doc/goRegForm?id=${list.id}'|">답변</button></td>
    </tr>
    </tbody>
</table>

<!-- 답변 완료 목록 -->
<h2>답변 완료</h2>
<table class="completed-table">
    <thead>
    <tr>
        <th>NO</th><th>제목</th><th>작성자</th><th>작성일</th><th>보기</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="list, iterStat : ${isAnswered}">
        <td th:text="${iterStat.index + 1}"></td>
        <td th:text="${list.title}"></td>
        <td th:text="${list.writer.username}"></td>
        <td th:text="${#temporals.format(list.createdAt, 'yyyy-MM-dd HH:mm:ss')}"></td>
        <td><button th:onclick="|openModal(${list.id})|">보기</button></td>
    </tr>
    </tbody>
</table>

<!-- 모달 -->
<div id="answerModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h1>답변 내역</h1>

        <div class="modal-section-title">문의 내역</div>
        <div class="info-row">
            <div class="info-label">작성일</div>
            <div class="info-value" id="modal-createdAt"></div>
        </div>
        <div class="info-row">
            <div class="info-label">작성자</div>
            <div class="info-value" id="modal-writer"></div>
        </div>
        <div class="info-row">
            <div class="info-label">제목</div>
            <div class="info-value" id="modal-title"></div>
        </div>
        <div class="info-row">
            <div class="info-label">문의내용</div>
            <div class="info-value" id="modal-content"></div>
        </div>

        <div class="modal-section-title">답변 내역</div>
        <div class="info-row">
            <div class="info-label">담당의사 ID</div>
            <div class="info-value" id="modal-doctorId"></div>
        </div>
        <div class="info-row">
            <div class="info-label">담당의사 이름</div>
            <div class="info-value" id="modal-doctorName"></div>
        </div>
        <div class="info-row">
            <div class="info-label">진료과목</div>
            <div class="info-value" id="modal-treatType"></div>
        </div>
        <div class="info-row">
            <div class="info-label">답변 내용</div>
            <div class="info-value" id="modal-answer"></div>
        </div>
    </div>
</div>

<script>
    async function openModal(id) {
        try {
            const res = await fetch(`/doc/getQnaDetail?id=${id}`, {
                headers: { 'Accept': 'application/json' }
            });
            const data = await res.json();

            document.getElementById('modal-createdAt').textContent = data.createdAt;
            document.getElementById('modal-writer').textContent = data.writerUsername;
            document.getElementById('modal-title').textContent = data.title;
            document.getElementById('modal-content').textContent = data.content;

            document.getElementById('modal-doctorId').textContent = data.doctorUsername;
            document.getElementById('modal-doctorName').textContent = data.doctorName;
            document.getElementById('modal-treatType').textContent = data.treatType;
            document.getElementById('modal-answer').textContent = data.answer;

            document.getElementById('answerModal').style.display = 'block';
        } catch (e) {
            alert('데이터를 가져오는 중 오류가 발생했습니다.');
        }
    }

    function closeModal() {
        document.getElementById('answerModal').style.display = 'none';
    }

    window.onclick = function (e) {
        const modal = document.getElementById('answerModal');
        if (e.target === modal) closeModal();
    };
</script>

</body>
</html>
