<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>μ§„λ£κ³Ό μ§λ¬Έ λ©λ΅</title>
    <meta charset="UTF-8">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

<h1 th:text="'[' + ${treatType} + '] μ§„λ£κ³Ό μμ‚¬ λ° μ§λ¬Έ λ©λ΅'"></h1>

<!-- π”Ή μμ‚¬ λ©λ΅ -->
<div>
    <h2>μμ‚¬ λ©λ΅</h2>
    <div id="doctor-list" style="display: flex; gap: 20px;">
        <div th:each="doctor : ${doctorList}" style="text-align: center; cursor: pointer;"
             th:data-id="${doctor.id}" class="doctor-item">
            <img th:src="@{/images/doctor_placeholder.png}" alt="μμ‚¬ μ‚¬μ§„" width="100" height="100" />
            <p th:text="${doctor.member.name}"></p>
        </div>
    </div>
</div>

<hr/>

<!-- π”Ή μ„ νƒ μμ‚¬ ν”„λ΅ν•„ -->
<div id="doctor-profile" style="display: none; border: 1px solid #000; padding: 10px; margin-top: 10px;">
    <h3>μμ‚¬ μ •λ³΄</h3>
    <p><strong>μ΄λ¦„:</strong> <span id="doc-name"></span></p>
    <p><strong>λ³‘μ›:</strong> <span id="doc-hospital"></span></p>
    <p><strong>μ§„λ£κ³Όλ©:</strong> <span id="doc-treat"></span></p>
    <p><strong>μ§„λ£μ‹κ°„:</strong> <span id="doc-time"></span></p>
</div>

<!-- π”Ή μ§λ¬Έ λ©λ΅ -->
<div id="doctor-questions" style="margin-top: 20px;">
    <h2>μ „μ²΄ μ§λ¬Έ λ©λ΅</h2>
    <table border="1" cellpadding="5" cellspacing="0">
        <thead>
        <tr>
            <th>μ λ©</th>
            <th>λ‹µλ³€μ—¬λ¶€</th>
        </tr>
        </thead>
        <tbody id="qna-table-body">
        <tr th:each="qna : ${qnaList}">
            <td><a th:href="@{'/dept/detail?id=' + ${qna.id}}" th:text="${qna.title}"></a></td>
            <td th:text="${qna.isAnswered == 'Y' ? 'λ‹µλ³€ μ™„λ£' : 'λ―Έλ‹µλ³€'}"></td>
        </tr>
        </tbody>
    </table>
</div>

<script>
    $(document).on('click', '.doctor-item', function () {
        let doctorId = $(this).data('id');

        $.ajax({
            url: '/dept/doctor',
            method: 'GET',
            data: { id: doctorId },
            success: function(data) {
                $('#doc-name').text(data.doctor.name);
                $('#doc-hospital').text(data.doctor.hospital);
                $('#doc-treat').text(data.doctor.treatType);
                $('#doc-time').text(data.doctor.hTime);
                $('#doctor-profile').show();

                let tbody = '';
                data.qnaList.forEach(qna => {
                    tbody += '<tr>' +
                        '<td><a href="/qna/detail?id=' + qna.id + '">' + qna.title + '</a></td>' +
                        '<td>' + (qna.isAnswered === 'Y' ? 'λ‹µλ³€ μ™„λ£' : 'λ―Έλ‹µλ³€') + '</td>' +
                        '</tr>';
                });
                $('#qna-table-body').html(tbody);
            },
            error: function () {
                alert('μμ‚¬ μ •λ³΄λ¥Ό λ¶λ¬μ¤λ” λ° μ‹¤ν¨ν–μµλ‹λ‹¤.');
            }
        });
    });
</script>

</body>
</html>