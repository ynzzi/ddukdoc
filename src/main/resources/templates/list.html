<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <title>ì§„ë£Œê³¼ ì§ˆë¬¸ ëª©ë¡</title>
    <meta charset="UTF-8">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        :root {
          --mint-primary: #3EB489;
          --mint-light: #E0F2F1;
          --mint-dark: #2A7864;
          --gray-light: #F7F9FA;
          --gray-mid: #B0B9BD;
          --gray-dark: #4A4A4A;
          --white: #FFFFFF;
        }
        body {
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          background-color: var(--gray-light);
          color: var(--gray-dark);
          margin: 2rem auto;
          max-width: 900px;
          padding: 1rem 2rem;
          line-height: 1.6;
        }
        h1 {
          color: var(--mint-primary);
          font-weight: 700;
          margin-bottom: 1rem;
          border-bottom: 3px solid var(--mint-primary);
          padding-bottom: 0.5rem;
        }
        h2 {
          color: var(--mint-dark);
          margin-top: 2rem;
          margin-bottom: 1rem;
          border-left: 6px solid var(--mint-primary);
          padding-left: 0.8rem;
        }
        /* ì˜ì‚¬ ëª©ë¡ ë°•ìŠ¤ */
        #doctor-list {
          display: flex;
          gap: 20px;
          flex-wrap: wrap;
        }
        .doctor-item {
          background-color: var(--white);
          border-radius: 10px;
          box-shadow: 0 3px 8px rgba(62,180,137,0.2);
          padding: 1rem;
          width: 130px;
          text-align: center;
          cursor: pointer;
          transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .doctor-item:hover {
          transform: translateY(-5px);
          box-shadow: 0 6px 15px rgba(42,120,100,0.4);
        }
        .doctor-item img {
          border-radius: 50%;
          margin-bottom: 0.5rem;
          border: 2px solid var(--mint-primary);
        }
        .doctor-item p {
          font-weight: 600;
          color: var(--mint-dark);
          margin: 0;
        }
        /* ì˜ì‚¬ í”„ë¡œí•„ */
        #doctor-profile {
          background-color: var(--white);
          border-radius: 10px;
          box-shadow: 0 3px 8px rgba(62,180,137,0.15);
          padding: 1rem 1.5rem;
          margin-top: 10px;
          display: none;
        }
        #doctor-profile h3 {
          color: var(--mint-primary);
          margin-top: 0;
        }
        #doctor-profile p {
          margin: 0.4rem 0;
        }
        #doctor-profile strong {
          color: var(--mint-dark);
        }
        /* ë¬¸ì˜ ë“±ë¡ ë²„íŠ¼ */
        #go-write-btn {
          margin-top: 1rem;
          background-color: var(--mint-primary);
          color: var(--white);
          border: none;
          padding: 0.6rem 1.2rem;
          border-radius: 8px;
          font-weight: 700;
          cursor: pointer;
          box-shadow: 0 4px 8px rgba(62,180,137,0.5);
          transition: background-color 0.3s ease;
          display: none;
        }
        #go-write-btn:hover {
          background-color: var(--mint-dark);
          box-shadow: 0 6px 12px rgba(42,120,100,0.7);
        }
        /* ì§ˆë¬¸ ëª©ë¡ í…Œì´ë¸” */
        table {
          width: 100%;
          border-collapse: collapse;
          background-color: var(--white);
          border-radius: 10px;
          overflow: hidden;
          box-shadow: 0 3px 8px rgba(62,180,137,0.15);
        }
        th, td {
          padding: 12px 15px;
          text-align: left;
          border-bottom: 1px solid var(--gray-light);
        }
        th {
          background-color: var(--mint-primary);
          color: var(--white);
          font-weight: 600;
        }
        tbody tr:hover {
          background-color: var(--mint-light);
        }
        tbody tr:last-child td {
          border-bottom: none;
        }
        a {
          color: var(--mint-dark);
          text-decoration: none;
          font-weight: 600;
        }
        a:hover {
          text-decoration: underline;
        }
    </style>
</head>
<body>

<h1 th:text="'[' + ${treatType} + '] ì§„ë£Œê³¼ ì˜ì‚¬ ë° ì§ˆë¬¸ ëª©ë¡'">[ë‚´ê³¼] ì§„ë£Œê³¼ ì˜ì‚¬ ë° ì§ˆë¬¸ ëª©ë¡</h1>

<!-- ğŸ”¹ ì˜ì‚¬ ëª©ë¡ -->
<div>
    <h2>ì˜ì‚¬ ëª©ë¡</h2>
    <div id="doctor-list">
        <div th:each="doctor : ${doctorList}" class="doctor-item" th:data-id="${doctor.id}">
            <img th:src="@{/images/doctor_placeholder.png}" alt="ì˜ì‚¬ ì‚¬ì§„" width="100" height="100" />
            <p th:text="${doctor.member.name}">í™ê¸¸ë™</p>
        </div>
    </div>
</div>

<hr/>

<!-- ğŸ”¹ ì„ íƒ ì˜ì‚¬ í”„ë¡œí•„ -->
<div id="doctor-profile">
    <h3>ì˜ì‚¬ ì •ë³´</h3>
    <p><strong>ì´ë¦„:</strong> <span id="doc-name"></span></p>
    <p><strong>ë³‘ì›:</strong> <span id="doc-hospital"></span></p>
    <p><strong>ì§„ë£Œê³¼ëª©:</strong> <span id="doc-treat"></span></p>
    <p><strong>ì§„ë£Œì‹œê°„:</strong> <span id="doc-time"></span></p>
</div>

<!-- ë“±ë¡ ë²„íŠ¼ (ì„ íƒí•œ ì˜ì‚¬ ì •ë³´ ì•„ë˜ì— ì¶”ê°€) -->
<div>
    <button id="go-write-btn">ë¬¸ì˜ ë“±ë¡</button>
</div>

<!-- ğŸ”¹ ì§ˆë¬¸ ëª©ë¡ -->
<div id="doctor-questions" style="margin-top: 20px;">
    <h2>ì „ì²´ ì§ˆë¬¸ ëª©ë¡</h2>
    <table>
        <thead>
        <tr>
            <th>ì œëª©</th>
            <th>ë‹µë³€ì—¬ë¶€</th>
        </tr>
        </thead>
        <tbody id="qna-table-body">
        <tr th:each="qna : ${qnaList}">
            <td><a th:href="@{'/dept/detail?id=' + ${qna.id}}" th:text="${qna.title}">ì§ˆë¬¸ ì œëª©</a></td>
            <td th:text="${qna.isAnswered == 'Y' ? 'ë‹µë³€ ì™„ë£Œ' : 'ë¯¸ë‹µë³€'}">ë‹µë³€ ìƒíƒœ</td>
        </tr>
        </tbody>
    </table>
</div>

<script>
    let selectedDoctorId = null;

    $(document).on('click', '.doctor-item', function () {
        selectedDoctorId = $(this).data('id');
        $('#go-write-btn').show();

        $.ajax({
            url: '/dept/doctor',
            method: 'GET',
            data: { id: selectedDoctorId },
            success: function(data) {
                $('#doc-name').text(data.doctor.name);
                $('#doc-hospital').text(data.doctor.hospital);
                $('#doc-treat').text(data.doctor.treatType);
                $('#doc-time').text(data.doctor.hTime);
                $('#doctor-profile').show();

                let tbody = '';
                data.qnaList.forEach(qna => {
                    tbody += '<tr>' +
                        '<td><a href="/dept/detail?id=' + qna.id + '">' + qna.title + '</a></td>' +
                        '<td>' + (qna.isAnswered === 'Y' ? 'ë‹µë³€ ì™„ë£Œ' : 'ë¯¸ë‹µë³€') + '</td>' +
                        '</tr>';
                });
                $('#qna-table-body').html(tbody);
            },
            error: function () {
                alert('ì˜ì‚¬ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        });
    });

    $('#go-write-btn').on('click', function () {
        if (selectedDoctorId) {
            location.href = '/qna/write?doctorId=' + selectedDoctorId;
        }
    });
</script>

</body>
</html>
