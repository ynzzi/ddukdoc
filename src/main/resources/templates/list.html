<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>진료과 질문 목록</title>
    <meta charset="UTF-8">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

<h1 th:text="'[' + ${treatType} + '] 진료과 의사 및 질문 목록'"></h1>

<!-- 🔹 의사 목록 -->
<div>
    <h2>의사 목록</h2>
    <div id="doctor-list" style="display: flex; gap: 20px;">
        <div th:each="doctor : ${doctorList}" style="text-align: center; cursor: pointer;"
             th:data-id="${doctor.id}" class="doctor-item">
            <img th:src="@{/images/doctor_placeholder.png}" alt="의사 사진" width="100" height="100" />
            <p th:text="${doctor.member.name}"></p>
        </div>
    </div>
</div>

<hr/>

<!-- 🔹 선택 의사 프로필 -->
<div id="doctor-profile" style="display: none; border: 1px solid #000; padding: 10px; margin-top: 10px;">
    <h3>의사 정보</h3>
    <p><strong>이름:</strong> <span id="doc-name"></span></p>
    <p><strong>병원:</strong> <span id="doc-hospital"></span></p>
    <p><strong>진료과목:</strong> <span id="doc-treat"></span></p>
    <p><strong>진료시간:</strong> <span id="doc-time"></span></p>
</div>
<!-- 등록 버튼 (선택한 의사 정보 아래에 추가) -->
<div style="margin-top: 10px;">
    <button id="go-write-btn" style="display: none;">문의 등록</button>
</div>

<!-- 🔹 질문 목록 -->
<div id="doctor-questions" style="margin-top: 20px;">
    <h2>전체 질문 목록</h2>
    <table border="1" cellpadding="5" cellspacing="0">
        <thead>
        <tr>
            <th>제목</th>
            <th>답변여부</th>
        </tr>
        </thead>
        <tbody id="qna-table-body">
        <tr th:each="qna : ${qnaList}">
            <td><a th:href="@{'/dept/detail?id=' + ${qna.id}}" th:text="${qna.title}"></a></td>
            <td th:text="${qna.isAnswered == 'Y' ? '답변 완료' : '미답변'}"></td>
        </tr>
        </tbody>
    </table>
</div>

<script>
    let selectedDoctorId = null;

    $(document).on('click', '.doctor-item', function () {
        selectedDoctorId = $(this).data('id');
        $('#go-write-btn').show();

        $.ajax({
            url: '/dept/doctor',
            method: 'GET',
            data: { id: selectedDoctorId },
            success: function(data) {
                $('#doc-name').text(data.doctor.name);
                $('#doc-hospital').text(data.doctor.hospital);
                $('#doc-treat').text(data.doctor.treatType);
                $('#doc-time').text(data.doctor.hTime);
                $('#doctor-profile').show();

                let tbody = '';
                data.qnaList.forEach(qna => {
                    tbody += '<tr>' +
                        '<td><a href="/dept/detail?id=' + qna.id + '">' + qna.title + '</a></td>' +
                        '<td>' + (qna.isAnswered === 'Y' ? '답변 완료' : '미답변') + '</td>' +
                        '</tr>';
                });
                $('#qna-table-body').html(tbody);
            },
            error: function () {
                alert('의사 정보를 불러오는 데 실패했습니다.');
            }
        });
    });

    $('#go-write-btn').on('click', function () {
        if (selectedDoctorId) {
            location.href = '/qna/write?doctorId=' + selectedDoctorId;
        }
    });
</script>


</body>
</html>