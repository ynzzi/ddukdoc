<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h1>로그인</h1>
<hr>
<form>
    아이디 <input type="text" id="username" name="username"><br>
    비밀번호 <input type="password" id="password" name="password"><br>
    <button type="button" onclick="login()">로그인</button>
</form>
<a href="/regist">회원가입</a>

<script>
    function login() {
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        fetch('/login/loginReg', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ username, password })
        })
        .then(res => {
            if (res.status === 200) {
                // 토큰 헤더 가져오기
                const token = res.headers.get('Authorization');
                return res.json().then(data => ({ role: data.role, token }));
            } else {
                return res.text().then(msg => { throw new Error(msg); });
            }
        })
        .then(data => {
            if (data.token) {
                localStorage.setItem('token', data.token); // 친구 코드 용
            }
            if (data.role === 'DOCTOR') {
                location.href = '/doc/qnaList';
            } else {
                location.href = '/';
            }
        })
        .catch(err => {
            alert(err.message || '아이디 또는 비밀번호를 확인하세요');
        });
    }
</script>


</body>
</html>