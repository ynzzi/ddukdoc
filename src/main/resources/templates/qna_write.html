<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>문의 등록</title>
  <meta charset="UTF-8">
</head>
<body>
<h2>문의 등록</h2>

<form id="qnaForm">
  <!-- 선택한 의사의 ID를 숨겨서 넘김 -->
  <input type="hidden" id="doctorId" th:value="${doctorId}">

  <p>
    <label>제목:</label><br>
    <input type="text" id="title" style="width: 100%;" placeholder="제목을 입력하세요">
  </p>
  <p>
    <label>내용:</label><br>
    <textarea id="content" style="width: 100%; height: 150px;" placeholder="문의 내용을 입력하세요"></textarea>
  </p>
  <button type="button" id="submitBtn">등록</button>
</form>

<script>
  document.getElementById("submitBtn").addEventListener("click", async function () {
      const token = localStorage.getItem("token");

      // ✅ 로그인 안 된 경우 차단
      if (!token) {
          alert("로그인이 필요합니다.");
          location.href = "/login";
          return;
      }

      const doctorId = document.getElementById("doctorId").value;
      const title = document.getElementById("title").value.trim();
      const content = document.getElementById("content").value.trim();

      if (!title || !content) {
          alert("제목과 내용을 모두 입력해주세요.");
          return;
      }

      try {
          const res = await fetch("/api/qna/new", {
              method: "POST",
              headers: {
                  "Content-Type": "application/json",
                  "Authorization": token
              },
              body: JSON.stringify({
                  doctorId: doctorId,
                  title: title,
                  content: content
              })
          });

          if (res.ok) {
              alert("문의가 등록되었습니다.");
              location.href = "/dept/list";
          } else {
              const error = await res.text();
              alert("등록 실패: " + error);
          }
      } catch (err) {
          console.error("등록 중 오류 발생:", err);
          alert("알 수 없는 오류가 발생했습니다.");
      }
  });
</script>
</body>
</html>
